cubes:
  - name: yaml_stripe_analytics
    sql_table: test_user_schema.stripe_analytics
    data_source: default

    joins: []

    dimensions:
      - name: month
        sql: month
        type: number

      - name: year
        sql: year
        type: number
        
      - name: customer_id
        sql: customer_id
        type: string

      - name: customer_email
        sql: customer_email
        type: string

      - name: subscription_start
        sql: subscription_start
        type: time

      - name: subscription_end
        sql: subscription_end
        type: time
        
      - name: product_name
        sql: product_name
        type: string
        
      - name: unit_moment
        sql: unit_moment
        type: number
        
      - name: new_customer
        sql: new_customer
        type: number
        
      - name: new_customer_invoice_amount
        sql: new_customer_invoice_amount
        type: number
        
      - name: new_customer_mrr
        sql: new_customer_mrr
        type: number
        
      - name: reactivated_customer
        sql: reactivated_customer
        type: number

      - name: reactivated_invoice_amount
        sql: reactivated_invoice_amount
        type: number
        
      - name: reactivated_mrr
        sql: reactivated_mrr
        type: number
       
      - name: upgraded_customer
        sql: upgraded_customer
        type: number  
        
      - name: upgraded_invoice_amount
        sql: upgraded_invoice_amount
        type: number  
        
      - name: upgraded_mrr
        sql: upgraded_mrr
        type: number  
        
      - name: downgraded_customer
        sql: downgraded_customer
        type: number 
        
      - name: downgraded_invoice_amount
        sql: downgraded_invoice_amount
        type: number 
        
      - name: downgraded_mrr
        sql: downgraded_mrr
        type: number 
        
      - name: voluntary_churned_customer
        sql: voluntary_churned_customer
        type: number 
        
      - name: voluntary_invoice_amount
        sql: voluntary_invoice_amount
        type: number 
        
      - name: voluntary_churned_mrr
        sql: voluntary_churned_mrr
        type: number 
        
      - name: delinquent_churned_customer
        sql: delinquent_churned_customer
        type: number 
        
      - name: delinquent_churned_invoice_amount
        sql: delinquent_churned_invoice_amount
        type: number 
        
      - name: delinquent_churned_mrr
        sql: delinquent_churned_mrr
        type: number 
        
    measures:
      - name: count_of_new_customers
        sql: customer_id
        type: count
        filters:
          - sql: "{CUBE}.new_customer = 1"
          
      - name: count_of_voluntary_churned_customers
        sql: customer_id
        type: count
        filters:
          - sql: "{CUBE}.voluntary_churned_customer = 1"
          
      - name: count_of_upgraded_customers
        sql: customer_id
        type: count
        filters:
          - sql: "{CUBE}.upgraded_customer = 1"
          
      - name: count_of_downgraded_customers
        sql: customer_id
        type: count
        filters:
          - sql: "{CUBE}.downgraded_customer = 1"
                   
      - name: count_of_reactivated_customers
        sql: customer_id
        type: count
        filters:
          - sql: "{CUBE}.reactivated_customer = 1"
      
      - name: count_of_delinquent_churned_customers
        sql: customer_id
        type: count
        filters:
          - sql: "{CUBE}.delinquent_churned_customer = 1"
          
      - name: mrr_of_new_customers
        sql: new_customer_mrr
        type: sum
        filters:
          - sql: "{CUBE}.new_customer = 1"
          
      - name: mrr_of_voluntary_churned_customers
        sql: voluntary_churned_mrr
        type: sum
        filters:
          - sql: "{CUBE}.voluntary_churned_customer = 1"
          
      - name: mrr_of_upgraded_customers
        sql: upgraded_mrr
        type: sum
        filters:
          - sql: "{CUBE}.upgraded_customer = 1"
          
      - name: mrr_of_downgraded_customers
        sql: downgraded_mrr
        type: sum
        filters:
          - sql: "{CUBE}.downgraded_customer = 1"
                   
      - name: mrr_of_reactivated_customers
        sql: reactivated_mrr
        type: sum
        filters:
          - sql: "{CUBE}.reactivated_customer = 1"
      
      - name: mrr_of_delinquent_churned_customers
        sql: delinquent_churned_mrr
        type: sum
        filters:
          - sql: "{CUBE}.delinquent_churned_customer = 1"


    pre_aggregations:
      # Pre-aggregation definitions go here.
      # Learn more in the documentation: https://cube.dev/docs/caching/pre-aggregations/getting-started
